---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "elasticstack_fleet_integration_policy Resource - terraform-provider-elasticstack"
subcategory: "Fleet"
description: |-
  Creates or updates a Fleet Integration Policy.
  It is highly recommended that all inputs and streams are provided in the
  Terraform plan, even if some are disabled. Otherwise, differences may appear
  between what is in the plan versus what is returned by the Fleet API.
  The Kibana Fleet UI https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html
  can be used as a reference for what data needs to be provided. Instead of saving
  a new integration configuration, the API request can be previewed, showing what
  values need to be provided for inputs and their streams.
---

# elasticstack_fleet_integration_policy (Resource)

Creates or updates a Fleet Integration Policy.

It is highly recommended that all inputs and streams are provided in the
Terraform plan, even if some are disabled. Otherwise, differences may appear
between what is in the plan versus what is returned by the Fleet API.

The [Kibana Fleet UI](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html)
can be used as a reference for what data needs to be provided. Instead of saving
a new integration configuration, the API request can be previewed, showing what
values need to be provided for inputs and their streams.

## Example Usage

```terraform
provider "elasticstack" {
  fleet {}
}

// The integration to use.
resource "elasticstack_fleet_integration" "sample" {
  name    = "tcp"
  version = "1.16.0"
  force   = true
}

// An agent policy to hold the integration policy.
resource "elasticstack_fleet_agent_policy" "sample" {
  name            = "Sample Agent Policy"
  namespace       = "default"
  description     = "A sample agent policy"
  monitor_logs    = true
  monitor_metrics = true
  skip_destroy    = false
}

// The associated enrollment token.
data "elasticstack_fleet_enrollment_tokens" "sample" {
  policy_id = elasticstack_fleet_agent_policy.sample.policy_id
}

// The integration policy.
resource "elasticstack_fleet_integration_policy" "sample" {
  name                = "Sample Integration Policy"
  namespace           = "default"
  description         = "A sample integration policy"
  agent_policy_id     = elasticstack_fleet_agent_policy.sample.policy_id
  integration_name    = elasticstack_fleet_integration.sample.name
  integration_version = elasticstack_fleet_integration.sample.version
  // Optional: specify a custom output to send data to
  // output_id           = "my-custom-output-id"

  inputs = {
    "tcp-tcp" = {
      enabled = true
      streams = {
        "tcp.generic" = {
          enabled = true,
          vars = jsonencode({
            "listen_address" : "localhost",
            "listen_port" : 8080,
            "data_stream.dataset" : "tcp.generic",
            "tags" : [],
            "syslog_options" : "field: message\n#format: auto\n#timezone: Local\n",
            "ssl" : "#certificate: |\n#    -----BEGIN CERTIFICATE-----\n#    ...\n#    -----END CERTIFICATE-----\n#key: |\n#    -----BEGIN PRIVATE KEY-----\n#    ...\n#    -----END PRIVATE KEY-----\n",
            "custom" : ""
          })
        }
      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `integration_name` (String) The name of the integration package.
- `integration_version` (String) The version of the integration package.
- `name` (String) The name of the integration policy.
- `namespace` (String) The namespace of the integration policy.

### Optional

- `agent_policy_id` (String) ID of the agent policy.
- `agent_policy_ids` (List of String) List of agent policy IDs.
- `description` (String) The description of the integration policy.
- `enabled` (Boolean) Enable the integration policy.
- `force` (Boolean) Force operations, such as creation and deletion, to occur.
- `inputs` (Attributes Map) Integration inputs mapped by input ID. (see [below for nested schema](#nestedatt--inputs))
- `output_id` (String) The ID of the output to send data to. When not specified, the default output of the agent policy will be used.
- `policy_id` (String) Unique identifier of the integration policy.
- `space_ids` (Set of String) The Kibana space IDs where this integration policy is available. When set, must match the space_ids of the referenced agent policy. If not set, will be inherited from the agent policy. Note: The order of space IDs does not matter as this is a set.
- `vars_json` (String, Sensitive) Integration-level variables as JSON.

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedatt--inputs"></a>
### Nested Schema for `inputs`

Optional:

- `enabled` (Boolean) Enable the input.
- `streams` (Attributes Map) Input streams mapped by stream ID. (see [below for nested schema](#nestedatt--inputs--streams))
- `vars` (String, Sensitive) Input-level variables as JSON.

<a id="nestedatt--inputs--streams"></a>
### Nested Schema for `inputs.streams`

Optional:

- `enabled` (Boolean) Enable the stream.
- `vars` (String, Sensitive) Stream-level variables as JSON.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import elasticstack_fleet_integration_policy.my_policy <fleet_integration_policy_id>
```
