---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "elasticstack_elasticsearch_ml_datafeed_state Resource - terraform-provider-elasticstack"
subcategory: "Ml"
description: |-
  page_title: "elasticstack_elasticsearch_ml_datafeed_state Resource - terraform-provider-elasticstack"
  subcategory: "Elasticsearch"
  description: |-
  Manages the state (started/stopped) of an Elasticsearch Machine Learning datafeed.
  elasticstack_elasticsearch_ml_datafeed_state (Resource)
  Manages the state of an existing Elasticsearch ML datafeed by starting or stopping it. This resource does not create or configure a datafeed, but instead manages the operational state of an existing datafeed.
  Example Usage
  
  resource "elasticstack_elasticsearch_ml_datafeed_state" "example" {
    datafeed_id = "datafeed-example"
    state       = "started"
    
    # Optional: specify start time for the datafeed
    start = "2023-01-01T00:00:00.000Z"
    
    # Optional: specify timeout
    datafeed_timeout = "30s"
  }
  
  Argument Reference
  datafeed_id - (Required) Identifier for the ML datafeed. Forces replacement when changed.state - (Required) The desired state for the ML datafeed. Valid values are started and stopped.force - (Optional) When stopping a datafeed, use to forcefully stop it. Default is false.start - (Optional) The time that the datafeed should start collecting data. When not specified, the datafeed starts in real-time. This property can be specified using ISO 8601 format with milliseconds (e.g., 2017-01-22T06:00:00.000Z) or as a timestamp in epoch milliseconds.end - (Optional) The time that the datafeed should end collecting data. When not specified, the datafeed continues in real-time. This property can be specified using ISO 8601 format with milliseconds (e.g., 2017-01-22T06:00:00.000Z) or as a timestamp in epoch milliseconds.datafeed_timeout - (Optional) Timeout for the operation. Examples: 30s, 5m, 1h. Default is 30s.
  Attribute Reference
  In addition to all arguments above, the following attributes are exported:
  id - Internal identifier of the resource.
  Import
  ML datafeed states can be imported using the datafeed ID:
  
  terraform import elasticstack_elasticsearch_ml_datafeed_state.example datafeed-example
---

# elasticstack_elasticsearch_ml_datafeed_state (Resource)

---
page_title: "elasticstack_elasticsearch_ml_datafeed_state Resource - terraform-provider-elasticstack"
subcategory: "Elasticsearch"
description: |-
  Manages the state (started/stopped) of an Elasticsearch Machine Learning datafeed.
---

# elasticstack_elasticsearch_ml_datafeed_state (Resource)

Manages the state of an existing Elasticsearch ML datafeed by starting or stopping it. This resource does not create or configure a datafeed, but instead manages the operational state of an existing datafeed.

## Example Usage

```terraform
resource "elasticstack_elasticsearch_ml_datafeed_state" "example" {
  datafeed_id = "datafeed-example"
  state       = "started"
  
  # Optional: specify start time for the datafeed
  start = "2023-01-01T00:00:00.000Z"
  
  # Optional: specify timeout
  datafeed_timeout = "30s"
}
```

## Argument Reference

* `datafeed_id` - (Required) Identifier for the ML datafeed. Forces replacement when changed.
* `state` - (Required) The desired state for the ML datafeed. Valid values are `started` and `stopped`.
* `force` - (Optional) When stopping a datafeed, use to forcefully stop it. Default is `false`.
* `start` - (Optional) The time that the datafeed should start collecting data. When not specified, the datafeed starts in real-time. This property can be specified using ISO 8601 format with milliseconds (e.g., `2017-01-22T06:00:00.000Z`) or as a timestamp in epoch milliseconds.
* `end` - (Optional) The time that the datafeed should end collecting data. When not specified, the datafeed continues in real-time. This property can be specified using ISO 8601 format with milliseconds (e.g., `2017-01-22T06:00:00.000Z`) or as a timestamp in epoch milliseconds.
* `datafeed_timeout` - (Optional) Timeout for the operation. Examples: `30s`, `5m`, `1h`. Default is `30s`.

## Attribute Reference

In addition to all arguments above, the following attributes are exported:

* `id` - Internal identifier of the resource.

## Import

ML datafeed states can be imported using the datafeed ID:

```shell
terraform import elasticstack_elasticsearch_ml_datafeed_state.example datafeed-example
```

## Example Usage

```terraform
resource "elasticstack_elasticsearch_index" "ml_datafeed_index" {
  name = "ml-datafeed-data"
  mappings = jsonencode({
    properties = {
      "@timestamp" = {
        type = "date"
      }
      value = {
        type = "double"
      }
      user = {
        type = "keyword"
      }
    }
  })
}

resource "elasticstack_elasticsearch_ml_anomaly_detection_job" "example" {
  job_id      = "example-anomaly-job"
  description = "Example anomaly detection job"

  analysis_config {
    bucket_span = "15m"
    detectors {
      function      = "mean"
      field_name    = "value"
      by_field_name = "user"
    }
  }

  data_description {
    time_field = "@timestamp"
  }
}

resource "elasticstack_elasticsearch_ml_datafeed" "example" {
  datafeed_id = "example-datafeed"
  job_id      = elasticstack_elasticsearch_ml_anomaly_detection_job.example.job_id
  indices     = [elasticstack_elasticsearch_index.ml_datafeed_index.name]

  query = jsonencode({
    bool = {
      must = [
        {
          range = {
            "@timestamp" = {
              gte = "now-7d"
            }
          }
        }
      ]
    }
  })
}

resource "elasticstack_elasticsearch_ml_datafeed_state" "example" {
  datafeed_id = elasticstack_elasticsearch_ml_datafeed.example.datafeed_id
  state       = "started"
  force       = false

  depends_on = [
    elasticstack_elasticsearch_ml_datafeed.example,
    elasticstack_elasticsearch_ml_anomaly_detection_job.example
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `datafeed_id` (String) Identifier for the ML datafeed.
- `state` (String) The desired state for the ML datafeed. Valid values are `started` and `stopped`.

### Optional

- `datafeed_timeout` (String) Timeout for the operation. Examples: `30s`, `5m`, `1h`. Default is `30s`.
- `elasticsearch_connection` (Block List, Deprecated) Elasticsearch connection configuration block. (see [below for nested schema](#nestedblock--elasticsearch_connection))
- `end` (String) The time that the datafeed should end collecting data. When not specified, the datafeed continues in real-time. This property must be specified in RFC 3339 format.
- `force` (Boolean) When stopping a datafeed, use to forcefully stop it.
- `start` (String) The time that the datafeed should start collecting data. When not specified, the datafeed starts in real-time. This property must be specified in RFC 3339 format.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `id` (String) Internal identifier of the resource

<a id="nestedblock--elasticsearch_connection"></a>
### Nested Schema for `elasticsearch_connection`

Optional:

- `api_key` (String, Sensitive) API Key to use for authentication to Elasticsearch
- `bearer_token` (String, Sensitive) Bearer Token to use for authentication to Elasticsearch
- `ca_data` (String) PEM-encoded custom Certificate Authority certificate
- `ca_file` (String) Path to a custom Certificate Authority certificate
- `cert_data` (String) PEM encoded certificate for client auth
- `cert_file` (String) Path to a file containing the PEM encoded certificate for client auth
- `endpoints` (List of String, Sensitive) A list of endpoints where the terraform provider will point to, this must include the http(s) schema and port number.
- `es_client_authentication` (String, Sensitive) ES Client Authentication field to be used with the JWT token
- `headers` (Map of String, Sensitive) A list of headers to be sent with each request to Elasticsearch.
- `insecure` (Boolean) Disable TLS certificate validation
- `key_data` (String, Sensitive) PEM encoded private key for client auth
- `key_file` (String) Path to a file containing the PEM encoded private key for client auth
- `password` (String, Sensitive) Password to use for API authentication to Elasticsearch.
- `username` (String) Username to use for API authentication to Elasticsearch.


<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import elasticstack_elasticsearch_ml_datafeed_state.example my-datafeed-id
```
