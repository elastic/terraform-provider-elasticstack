---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "elasticstack_elasticsearch_security_api_key Resource - terraform-provider-elasticstack"
subcategory: "Security"
description: |-
  Creates an API key for access without requiring basic authentication. Supports both regular API keys and cross-cluster API keys. See the security API create API key documentation https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html and create cross-cluster API key documentation https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-cross-cluster-api-key.html for more details.
---

# elasticstack_elasticsearch_security_api_key (Resource)

Creates an API key for access without requiring basic authentication. Supports both regular API keys and cross-cluster API keys. See the [security API create API key documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html) and [create cross-cluster API key documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-cross-cluster-api-key.html) for more details.

## Example Usage

```terraform
resource "elasticstack_elasticsearch_security_api_key" "api_key" {
  # Set the name
  name = "My API key"

  # Set the role descriptors
  role_descriptors = jsonencode({
    role-a = {
      cluster = ["all"],
      indices = [
        {
          names      = ["index-a*"],
          privileges = ["read"]
        }
      ]
    }
  })

  # Set the expiration for the API key
  expiration = "1d"

  # Set the custom metadata for this user
  metadata = jsonencode({
    "env"    = "testing"
    "open"   = false
    "number" = 49
  })
}

# restriction on a role descriptor for an API key is supported since Elastic 8.9
resource "elasticstack_elasticsearch_security_api_key" "api_key_with_restriction" {
  # Set the name
  name = "My API key"
  # Set the role descriptors
  role_descriptors = jsonencode({
    role-a = {
      cluster = ["all"],
      indices = [
        {
          names      = ["index-a*"],
          privileges = ["read"]
        }
      ],
      restriction = {
        workflows = ["search_application_query"]
      }
    }
  })

  # Set the expiration for the API key
  expiration = "1d"

  # Set the custom metadata for this user
  metadata = jsonencode({
    "env"    = "testing"
    "open"   = false
    "number" = 49
  })
}

output "api_key" {
  value     = elasticstack_elasticsearch_security_api_key.api_key
  sensitive = true
}

# Example: Cross-cluster API key
resource "elasticstack_elasticsearch_security_api_key" "cross_cluster_key" {
  name = "My Cross-Cluster API Key"
  type = "cross_cluster"

  # Define access permissions for cross-cluster operations
  access = {

    # Grant replication access to specific indices  
    replication = [
      {
        names = ["archive-*"]
      }
    ]
  }

  # Set the expiration for the API key
  expiration = "30d"

  # Set arbitrary metadata
  metadata = jsonencode({
    description = "Cross-cluster key for production environment"
    environment = "production"
    team        = "platform"
  })
}

output "cross_cluster_api_key" {
  value     = elasticstack_elasticsearch_security_api_key.cross_cluster_key
  sensitive = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Specifies the name for this API key.

### Optional

- `access` (Attributes) Access configuration for cross-cluster API keys. Only applicable when type is 'cross_cluster'. (see [below for nested schema](#nestedatt--access))
- `elasticsearch_connection` (Block List, Deprecated) Elasticsearch connection configuration block. (see [below for nested schema](#nestedblock--elasticsearch_connection))
- `expiration` (String) Expiration time for the API key. By default, API keys never expire.
- `metadata` (String) Arbitrary metadata that you want to associate with the API key.
- `role_descriptors` (String) Role descriptors for this API key.
- `type` (String) The type of API key. Valid values are 'rest' (default) and 'cross_cluster'. Cross-cluster API keys are used for cross-cluster search and replication.

### Read-Only

- `api_key` (String, Sensitive) Generated API Key.
- `encoded` (String, Sensitive) API key credentials which is the Base64-encoding of the UTF-8 representation of the id and api_key joined by a colon (:).
- `expiration_timestamp` (Number) Expiration time in milliseconds for the API key. By default, API keys never expire.
- `id` (String) Internal identifier of the resource.
- `key_id` (String) Unique id for this API key.

<a id="nestedatt--access"></a>
### Nested Schema for `access`

Optional:

- `replication` (Attributes List) A list of replication configurations for which the cross-cluster API key will have replication privileges. (see [below for nested schema](#nestedatt--access--replication))
- `search` (Attributes List) A list of search configurations for which the cross-cluster API key will have search privileges. (see [below for nested schema](#nestedatt--access--search))

<a id="nestedatt--access--replication"></a>
### Nested Schema for `access.replication`

Required:

- `names` (List of String) A list of index patterns for replication.


<a id="nestedatt--access--search"></a>
### Nested Schema for `access.search`

Required:

- `names` (List of String) A list of index patterns for search.

Optional:

- `allow_restricted_indices` (Boolean) Whether to allow access to restricted indices.
- `field_security` (String) Field-level security configuration in JSON format.
- `query` (String) Query to filter documents for search operations in JSON format.



<a id="nestedblock--elasticsearch_connection"></a>
### Nested Schema for `elasticsearch_connection`

Optional:

- `api_key` (String, Sensitive) API Key to use for authentication to Elasticsearch
- `bearer_token` (String, Sensitive) Bearer Token to use for authentication to Elasticsearch
- `ca_data` (String) PEM-encoded custom Certificate Authority certificate
- `ca_file` (String) Path to a custom Certificate Authority certificate
- `cert_data` (String) PEM encoded certificate for client auth
- `cert_file` (String) Path to a file containing the PEM encoded certificate for client auth
- `endpoints` (List of String, Sensitive) A list of endpoints where the terraform provider will point to, this must include the http(s) schema and port number.
- `es_client_authentication` (String, Sensitive) ES Client Authentication field to be used with the JWT token
- `headers` (Map of String, Sensitive) A list of headers to be sent with each request to Elasticsearch.
- `insecure` (Boolean) Disable TLS certificate validation
- `key_data` (String, Sensitive) PEM encoded private key for client auth
- `key_file` (String) Path to a file containing the PEM encoded private key for client auth
- `password` (String, Sensitive) Password to use for API authentication to Elasticsearch.
- `username` (String) Username to use for API authentication to Elasticsearch.
