
---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "elasticstack_kibana_security_detection_rule Resource - terraform-provider-elasticstack"
subcategory: "Kibana"
description: |-
  Creates or updates a Kibana security detection rule. See the rules API documentation https://www.elastic.co/guide/en/security/current/rules-api-create.html for more details.
---

# elasticstack_kibana_security_detection_rule (Resource)

Creates or updates a Kibana security detection rule. See the [rules API documentation](https://www.elastic.co/guide/en/security/current/rules-api-create.html) for more details.

## Example Usage

```terraform
provider "elasticstack" {
  kibana {}
}

# Basic security detection rule
resource "elasticstack_kibana_security_detection_rule" "example" {
  name        = "Suspicious Activity Detection"
  type        = "query"
  query       = "event.action:logon AND user.name:admin"
  language    = "kuery"
  enabled     = true
  description = "Detects suspicious admin logon activities"
  severity    = "high"
  risk_score  = 75
  from        = "now-6m"
  to          = "now"
  interval    = "5m"

  author          = ["Security Team"]
  tags            = ["security", "authentication", "admin"]
  license         = "Elastic License v2"
  false_positives = ["Legitimate admin access during maintenance windows"]
  references = [
    "https://example.com/security-docs",
    "https://example.com/admin-access-policy"
  ]

  note  = "Investigate the source IP and verify if the admin access is legitimate."
  setup = "Ensure that authentication logs are being collected and indexed."
}

# Advanced security detection rule with custom settings
resource "elasticstack_kibana_security_detection_rule" "advanced" {
  name        = "Advanced Threat Detection"
  type        = "query"
  query       = "process.name:powershell.exe AND process.args:*encoded*"
  language    = "kuery"
  enabled     = true
  description = "Detects encoded PowerShell commands which may indicate malicious activity"
  severity    = "critical"
  risk_score  = 90
  from        = "now-10m"
  to          = "now"
  interval    = "2m"
  max_signals = 200
  version     = 1

  index = [
    "winlogbeat-*",
    "logs-windows-*"
  ]

  author = [
    "Threat Intelligence Team",
    "SOC Analysts"
  ]

  tags = [
    "windows",
    "powershell",
    "encoded",
    "malware",
    "critical"
  ]

  false_positives = [
    "Legitimate encoded PowerShell scripts used by automation",
    "Software installation scripts"
  ]

  references = [
    "https://attack.mitre.org/techniques/T1059/001/",
    "https://example.com/powershell-security-guide"
  ]

  license = "Elastic License v2"
  note    = <<-EOT
    ## Investigation Steps
    1. Examine the full PowerShell command line
    2. Decode any base64 encoded content
    3. Check the parent process that spawned PowerShell
    4. Review network connections made during execution
    5. Check for file system modifications
  EOT

  setup = <<-EOT
    ## Prerequisites
    - Windows endpoint monitoring must be enabled
    - PowerShell logging should be configured
    - Sysmon or equivalent process monitoring required
  EOT
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `description` (String) The rule's description.
- `name` (String) A human-readable name for the rule.
- `type` (String) Rule type. Supported types: query, eql, esql, machine_learning, new_terms, saved_query, threat_match, threshold.

### Optional

- `anomaly_threshold` (Number) Anomaly score threshold above which the rule creates an alert. Valid values are from 0 to 100. Required for machine_learning rules.
- `author` (List of String) The rule's author.
- `concurrent_searches` (Number) Number of concurrent searches for threat intelligence. Optional for threat_match rules.
- `enabled` (Boolean) Determines whether the rule is enabled.
- `false_positives` (List of String) String array used to describe common reasons why the rule may issue false-positive alerts.
- `from` (String) Time from which data is analyzed each time the rule runs, using a date math range.
- `history_window_start` (String) Start date to use when checking if a term has been seen before. Supports relative dates like 'now-30d'. Required for new_terms rules.
- `index` (List of String) Indices on which the rule functions.
- `interval` (String) Frequency of rule execution, using a date math range.
- `items_per_search` (Number) Number of items to search for in each concurrent search. Optional for threat_match rules.
- `language` (String) The query language (KQL or Lucene).
- `license` (String) The rule's license.
- `machine_learning_job_id` (List of String) Machine learning job ID(s) the rule monitors for anomaly scores. Required for machine_learning rules.
- `max_signals` (Number) Maximum number of alerts the rule can create during a single run.
- `new_terms_fields` (List of String) Field names containing the new terms. Required for new_terms rules.
- `note` (String) Notes to help investigate alerts produced by the rule.
- `query` (String) The query language definition.
- `references` (List of String) String array containing references and URLs to sources of additional information.
- `risk_score` (Number) A numerical representation of the alert's severity from 0 to 100.
- `rule_id` (String) A stable unique identifier for the rule object. If omitted, a UUID is generated.
- `saved_id` (String) Identifier of the saved query used for the rule. Required for saved_query rules.
- `setup` (String) Setup guide with instructions on rule prerequisites.
- `severity` (String) Severity level of alerts produced by the rule.
- `space_id` (String) An identifier for the space. If space_id is not provided, the default space is used.
- `tags` (List of String) String array containing words and phrases to help categorize, filter, and search rules.
- `threat` (Attributes List) MITRE ATT&CK framework threat information. (see [below for nested schema](#nestedatt--threat))
- `threat_filters` (List of String) Additional filters for threat intelligence data. Optional for threat_match rules.
- `threat_index` (List of String) Array of index patterns for the threat intelligence indices. Required for threat_match rules.
- `threat_indicator_path` (String) Path to the threat indicator in the indicator documents. Optional for threat_match rules.
- `threat_mapping` (Attributes List) Array of threat mappings that specify how to match events with threat intelligence. Required for threat_match rules. (see [below for nested schema](#nestedatt--threat_mapping))
- `threat_query` (String) Query used to filter threat intelligence data. Optional for threat_match rules.
- `threshold` (Attributes) Threshold settings for the rule. Required for threshold rules. (see [below for nested schema](#nestedatt--threshold))
- `tiebreaker_field` (String) Sets the tiebreaker field. Required for EQL rules when event.dataset is not provided.
- `timeline_id` (String) Timeline template ID for the rule.
- `timeline_title` (String) Timeline template title for the rule.
- `to` (String) Time to which data is analyzed each time the rule runs, using a date math range.
- `version` (Number) The rule's version number.

### Read-Only

- `created_at` (String) The time the rule was created.
- `created_by` (String) The user who created the rule.
- `id` (String) Internal identifier of the resource
- `revision` (Number) The rule's revision number.
- `updated_at` (String) The time the rule was last updated.
- `updated_by` (String) The user who last updated the rule.

<a id="nestedatt--threat"></a>
### Nested Schema for `threat`

Required:

- `framework` (String) Threat framework (typically 'MITRE ATT&CK').
- `tactic` (Attributes) MITRE ATT&CK tactic information. (see [below for nested schema](#nestedatt--threat--tactic))

Optional:

- `technique` (Attributes List) MITRE ATT&CK technique information. (see [below for nested schema](#nestedatt--threat--technique))

<a id="nestedatt--threat--tactic"></a>
### Nested Schema for `threat.tactic`

Required:

- `id` (String) MITRE ATT&CK tactic ID.
- `name` (String) MITRE ATT&CK tactic name.
- `reference` (String) MITRE ATT&CK tactic reference URL.


<a id="nestedatt--threat--technique"></a>
### Nested Schema for `threat.technique`

Required:

- `id` (String) MITRE ATT&CK technique ID.
- `name` (String) MITRE ATT&CK technique name.
- `reference` (String) MITRE ATT&CK technique reference URL.

Optional:

- `subtechnique` (Attributes List) MITRE ATT&CK sub-technique information. (see [below for nested schema](#nestedatt--threat--technique--subtechnique))

<a id="nestedatt--threat--technique--subtechnique"></a>
### Nested Schema for `threat.technique.subtechnique`

Required:

- `id` (String) MITRE ATT&CK sub-technique ID.
- `name` (String) MITRE ATT&CK sub-technique name.
- `reference` (String) MITRE ATT&CK sub-technique reference URL.




<a id="nestedatt--threat_mapping"></a>
### Nested Schema for `threat_mapping`

Required:

- `entries` (Attributes List) Array of mapping entries. (see [below for nested schema](#nestedatt--threat_mapping--entries))

<a id="nestedatt--threat_mapping--entries"></a>
### Nested Schema for `threat_mapping.entries`

Required:

- `field` (String) Event field to match.
- `type` (String) Type of match (mapping).
- `value` (String) Threat intelligence field to match against.



<a id="nestedatt--threshold"></a>
### Nested Schema for `threshold`

Required:

- `value` (Number) The threshold value from which an alert is generated.

Optional:

- `cardinality` (Attributes List) Cardinality settings for threshold rule. (see [below for nested schema](#nestedatt--threshold--cardinality))
- `field` (List of String) Field(s) to use for threshold aggregation.

<a id="nestedatt--threshold--cardinality"></a>
### Nested Schema for `threshold.cardinality`

Required:

- `field` (String) The field on which to calculate and compare the cardinality.
- `value` (Number) The threshold cardinality value.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import elasticstack_kibana_security_detection_rule.example default/12345678-1234-1234-1234-123456789abc
```
